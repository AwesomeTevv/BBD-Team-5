<!DOCTYPE html>
<html>
  <head>
    <title>Jackbox Clone</title>
    <script src="/socket.io/socket.io.js"></script>
    <script src="main.js"></script>
    <style>
      #start-screen,
      #lobby-screen,
      #join-screen,
      #main-screen,
      #player-screen {
        display: none;
      }
    </style>
  </head>
  <body>
    <div id="start-screen">
      <button id="start-room-button">Start a Room</button>
      <button id="join-room-button">Join a Room</button>
    </div>

    <div id="lobby-screen">
      <h1>Lobby</h1>
      <p>Room Code: <span id="room-code"></span></p>
      <div id="player-list"></div>
      <button id="start-game-button">Start Game</button>
    </div>

    <div id="join-screen">
      <h1>Join Room</h1>
      <input type="text" id="player-name" placeholder="Your name" />
      <input type="text" id="join-room-code" placeholder="Room Code" />
      <button id="join-room-confirm-button">Join Room</button>
    </div>

    <div id="main-screen">
      <h1>Game Screen</h1>
      <div id="gyroscope-data"></div>
    </div>

    <div id="player-screen">
      <h1>Player Screen</h1>
      <div id="actions"></div>
    </div>

    <script>
      const socket = io();

      // Elements
      const startScreen = document.getElementById("start-screen");
      const lobbyScreen = document.getElementById("lobby-screen");
      const joinScreen = document.getElementById("join-screen");
      const mainScreen = document.getElementById("main-screen");
      const playerScreen = document.getElementById("player-screen");
      const roomCodeSpan = document.getElementById("room-code");
      const playerList = document.getElementById("player-list");
      const gyroscopeDataDiv = document.getElementById("gyroscope-data");

      // Initial screen
      startScreen.style.display = "block";

      document
        .getElementById("start-room-button")
        .addEventListener("click", () => {
          socket.emit("createRoom");
        });

      socket.on("roomCreated", (roomId) => {
        startScreen.style.display = "none";
        lobbyScreen.style.display = "block";
        roomCodeSpan.textContent = roomId;
      });

      document
        .getElementById("join-room-button")
        .addEventListener("click", () => {
          startScreen.style.display = "none";
          joinScreen.style.display = "block";
        });

      document
        .getElementById("join-room-confirm-button")
        .addEventListener("click", () => {
          const roomId = document.getElementById("join-room-code").value;
          const playerName = document.getElementById("player-name").value;
          socket.emit("joinGame", roomId, playerName);
          joinScreen.style.display = "none";
          playerScreen.style.display = "block";

          if (window.DeviceOrientationEvent) {
            window.addEventListener("deviceorientation", (event) => {
              const data = {
                alpha: event.alpha,
                beta: event.beta,
                gamma: event.gamma,
              };
              socket.emit("gyroscopeData", roomId, data);
            });
          } else {
            alert("Device orientation not supported");
          }
        });

      document
        .getElementById("start-game-button")
        .addEventListener("click", () => {
          const roomId = roomCodeSpan.textContent;
          socket.emit("startGame", roomId);
        });

      socket.on("playerJoined", (playerName) => {
        const newPlayer = document.createElement("div");
        newPlayer.textContent = playerName;
        playerList.appendChild(newPlayer);
      });

      socket.on("gameStarted", () => {
        lobbyScreen.style.display = "none";
        mainScreen.style.display = "block";
        playerScreen.style.display = "block";
      });

      socket.on("gyroscopeData", (data) => {
        gyroscopeDataDiv.textContent = `Alpha: ${data.alpha.toFixed(
          2
        )}, Beta: ${data.beta.toFixed(2)}, Gamma: ${data.gamma.toFixed(2)}`;
      });

      socket.on("playerAction", (action) => {
        // Handle player actions
      });
    </script>
  </body>
</html>
